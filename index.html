<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>R Package Development for Research</title>
    <meta charset="utf-8" />
    <meta name="author" content="Valentin Lucet" />
    <meta name="date" content="2021-07-30" />
    <script src="index_files/header-attrs/header-attrs.js"></script>
    <link href="index_files/tile-view/tile-view.css" rel="stylesheet" />
    <script src="index_files/tile-view/tile-view.js"></script>
    <script src="index_files/clipboard/clipboard.min.js"></script>
    <link href="index_files/shareon/shareon.min.css" rel="stylesheet" />
    <script src="index_files/shareon/shareon.min.js"></script>
    <link href="index_files/xaringanExtra-shareagain/shareagain.css" rel="stylesheet" />
    <script src="index_files/xaringanExtra-shareagain/shareagain.js"></script>
    <script src="index_files/js-cookie/js.cookie.js"></script>
    <script src="index_files/peerjs/peerjs.min.js"></script>
    <script src="index_files/tiny.toast/toast.min.js"></script>
    <link href="index_files/xaringanExtra-broadcast/broadcast.css" rel="stylesheet" />
    <script src="index_files/xaringanExtra-broadcast/broadcast.js"></script>
    <script src="index_files/fabric/fabric.min.js"></script>
    <link href="index_files/xaringanExtra-scribble/scribble.css" rel="stylesheet" />
    <script src="index_files/xaringanExtra-scribble/scribble.js"></script>
    <script>document.addEventListener('DOMContentLoaded', function() { window.xeScribble = new Scribble({"pen_color":["#FF0000"],"pen_size":3,"eraser_size":30,"palette":[]}) })</script>
    <link href="index_files/animate.css/animate.xaringan.css" rel="stylesheet" />
    <link href="index_files/panelset/panelset.css" rel="stylesheet" />
    <script src="index_files/panelset/panelset.js"></script>
    <link href="index_files/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="index_files/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <script src="index_files/xaringanExtra_fit-screen/fit-screen.js"></script>
    <script src="index_files/xaringanExtra-webcam/webcam.js"></script>
    <script id="xaringanExtra-webcam-options" type="application/json">{"width":"200","height":"200","margin":"1em"}</script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# R Package Development for Research
## <em>An Introduction</em>
### Valentin Lucet
### 2021-07-30

---


&lt;!-- --&gt;







## About me

&lt;img align="right" width="210" height="210" alt="a picture of Val" src="images/val.jpeg"&gt;

 * __RSE__ at __Concordia University__ (lab of Dr. Eric Pedersen)
 
 * __Data Scientist__ at __Environment Canada (ECCC)__ (Landscape Science Unit)
 
 * Have been coding in R for ~ 7-8 years
 
 * Maintaining 4 packages (2 on CRAN), contributed to 3 other
 
 * B.Sc. (Hons) &amp; M.Sc. McGill University (Biology)
 
 * Website: [___vlucet.github.io___](https://vlucet.github.io/)

---
name: plan 1
## Workshop: Part 1 (now -&gt; 10:30)

&lt;!-- 9:30 - 9:35 : let people trickle in --&gt;
&lt;!-- 9:35 - 9:40 : personal introduction --&gt;

1. __Research software in Eco-Evo__ (__~ 10 minutes__) &lt;!-- 9:40 - 9:50 --&gt;
  * What is research software?
  * To Package or not to Package: what are the alternatives?
    
2. __Design patterns: the "tooling" vs "workflow" paradigms__ (__~ 10 minutes__) &lt;!-- 9:50 - 10:00 --&gt;
  * General vs workflow oriented packaging.
  * Object-oriented designs and functional programming.
  
3. __From "spaghetti code" to "packaged" code__ (__~ 20 minutes__) &lt;!-- 10:00 - 10:20 --&gt;
  * Tips and tricks to modularize your research code.
  * How to write clean code.
  
(_Break: 10 minutes_) &lt;!-- 10:20 - 10:30 --&gt;

---
name: plan 2
## Workshop: Parts 2 &amp; 3 (10:30 -&gt; 12:30)

4. __Your personal assistants: `usethis` and `devtools`__ (__~ 50 minutes__) &lt;!-- 10:30 - 11:20 --&gt;
  * Let's create an example package step by step.
  * (__Break: 10 minutes__) &lt;!-- 11:20 - 11:30 --&gt;
5. __Package testing, maintenance and distribution: best practices__ (__~ 50 minutes__) &lt;!-- 11:30 - 12:20 --&gt;
  * How to test, maintain, and distribute your package.

__Q &amp; A__: __~ 10 minutes__ (or on the conference app at any time) 

![XKCD comic. Two characters. Character 1 says what they are trying to do on the computer shouldn't be too hard. Character 2 says that computers are just "organized sand" and that everything is hard untol someone makes it easy". Character 2 decides to turns the computer back to sand and character 2 says they'll get a blowtorch! ](https://imgs.xkcd.com/comics/shouldnt_be_hard.png)
---
name: prereqs

# Before we get started...

For today, it is recommended that you are already pretty well acquainted with __R__ and __Rstudio__. But, if at least you...
  * Have written a few __functions with multiple arguments__ in R 
  * Know about "__project oriented workflow__" (for instance you use RStudio projects) 
  
...then you have the bare minimum we need for today!

Knowledge of Git/Github is also welcome as I won't have the time to explain version control software.


```r
# Run this in R before we start. 
pkgs &lt;- c("devtools", "roxygen2", "usethis")
install.packages(pkgs)
```

_Note: the first part of the workshop is relevant to users of any level._

---
name: refs

# On not reinventing the wheel...

There exists a __plethora of great resources on R package making__, resources from which I have learned myself. 

This workshop has been devised by attempting to __synthesize many freely available resources__ put together by a whole bunch of excellent people. 

_A full list of resources is included at the end of this workshop._

.center[
![Comic, 2 characters. The first character shows a picture of a wheel to a befuddled second character and says "I have a great idea!"](https://miro.medium.com/max/240/0*FiszegEhSoYnfqO9.png)
]

---
class: inverse center middle

# Research software in Eco-Evo 

---
# What is research software?
&lt;!-- All the programs that support research, from the code written to program a microscope, to the movement detection programs in camera traps, all code to generate analyses but also all code used to generate figures --&gt;

---
# Who writes research software?
&lt;!-- Engineers, yes, but mostly scientists: they are all RSEs. Speak about how these skills are in higher demand and we dont necessarily have the skills to maintain code etc... --&gt;

---
# Open source vs proprietary software
&lt;!-- Introduce OSS, use the xkcd "jenga" tower comic --&gt;

---
# Is software a scientific contribution?
&lt;!-- YES! Should be recognized as one. JOSS, ROpenSci, maybe cite the talk by Richard McElreath --&gt;

---
# What forms does research software take?
&lt;!-- Packages, yes BUT also research compendiums, code that is shared as scripts, zipped archive, etc... in increasing order of generated entropy... --&gt;

---
# To Package or not to Package?
&lt;!-- Reuse Maelle Simon's work (make sure to cite properly): Should your package even exist?. Include comment on lab/personnal package --&gt;

---
# To Package or not to Package? (cont'd)
&lt;!-- Discuss the effort at different stages of research. --&gt;

---
# What should a package contain?
&lt;!-- re M.S. blogpost --&gt;

---
# How to name your package
&lt;!-- Naming is hard ! small cases, check with {available} --&gt;

---
class: inverse center middle

# Design patterns: "tooling" vs "workflow"

---
# Reasons to make a package fall into 2 broad categories
&lt;!-- One is to provide a general tool, the other to make a certain workflow replicable and adaptable. This is on a continuum from generality to specificity. In the end, two faces of the same coin --&gt;

---
# "tooling" packages
&lt;!-- Characteristics: general, no object structure (or very light). One function does one thing. Lab package, personal package --&gt;

---
# "workflow" packages 
&lt;!-- Makes a specific research workflow available, can have a strong object structure (but beware!). In the back, may be built with simpler "tooling" elements --&gt;

---
# A research package decision chart
&lt;!-- Make a decision chart that sums up all we talked about and if we have time ask if there are any questions --&gt;

---
class: inverse center middle

# From "spaghetti code" to "packaged" code 

---
# Messy code is ubiquitous in research
&lt;!-- Messy code is not necessarily bad code, but one could argue that it is "unfinished code", no one took the time to clean it up. Why? talk about how this part of the research process might not be valorized as much. --&gt;

---
# How to write clean code (in general)
&lt;!-- Style guide, clear names, small functions, useful comments, see the clean code lectures on youtube maybe --&gt;

---
# Packaging messy research code
&lt;!-- [mention that these principles are even better to implement as one *writes* the code] identify steps (for workflow) or manipulations and "re-factor" the code into functions, =&gt; then work on modularizing the code, i.e. placing functions in different scripts that can be sourced. etc... --&gt;

---
# Packaging messy research code (cont'd)
&lt;!-- continue the discussion =&gt; think about object oriented design, write a class diagram maybe, and think about attributes that need to be kept track of --&gt;

---
# OOP in R
&lt;!-- use hadley's book in thi section to write an intro to the different OOP systems in R --&gt;

---
class: inverse center middle

# A package step by step with {usethis} and {devtools}

---
class: inverse center middle

# Package testing, maintenance and distribution: best practices

---
class: center, middle

# Thanks!

Slides created via the R packages:

[**xaringan**](https://github.com/yihui/xaringan)&lt;br&gt;
[gadenbuie/xaringanthemer](https://github.com/gadenbuie/xaringanthemer)

---
name: sources

# Sources

* Maelle Simon's [How to develop good R packages (for open science)](https://masalmon.eu/2017/12/11/goodrpackages/)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "%current%",
"highlightStyle": "github",
"highlightLines": true,
"ratio": "4:3",
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
