<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>R Package Development for Research</title>
    <meta charset="utf-8" />
    <meta name="author" content="Valentin Lucet" />
    <meta name="date" content="2021-08-03" />
    <script src="index_files/header-attrs/header-attrs.js"></script>
    <link href="index_files/tile-view/tile-view.css" rel="stylesheet" />
    <script src="index_files/tile-view/tile-view.js"></script>
    <script src="index_files/clipboard/clipboard.min.js"></script>
    <link href="index_files/shareon/shareon.min.css" rel="stylesheet" />
    <script src="index_files/shareon/shareon.min.js"></script>
    <link href="index_files/xaringanExtra-shareagain/shareagain.css" rel="stylesheet" />
    <script src="index_files/xaringanExtra-shareagain/shareagain.js"></script>
    <script src="index_files/js-cookie/js.cookie.js"></script>
    <script src="index_files/peerjs/peerjs.min.js"></script>
    <script src="index_files/tiny.toast/toast.min.js"></script>
    <link href="index_files/xaringanExtra-broadcast/broadcast.css" rel="stylesheet" />
    <script src="index_files/xaringanExtra-broadcast/broadcast.js"></script>
    <script src="index_files/fabric/fabric.min.js"></script>
    <link href="index_files/xaringanExtra-scribble/scribble.css" rel="stylesheet" />
    <script src="index_files/xaringanExtra-scribble/scribble.js"></script>
    <script>document.addEventListener('DOMContentLoaded', function() { window.xeScribble = new Scribble({"pen_color":["#FF0000"],"pen_size":3,"eraser_size":30,"palette":[]}) })</script>
    <link href="index_files/animate.css/animate.xaringan.css" rel="stylesheet" />
    <link href="index_files/panelset/panelset.css" rel="stylesheet" />
    <script src="index_files/panelset/panelset.js"></script>
    <link href="index_files/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="index_files/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <script src="index_files/xaringanExtra_fit-screen/fit-screen.js"></script>
    <script src="index_files/xaringanExtra-webcam/webcam.js"></script>
    <script id="xaringanExtra-webcam-options" type="application/json">{"width":"200","height":"200","margin":"1em"}</script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# R Package Development for Research
## <em>An Introduction</em>
### Valentin Lucet
### 2021-08-03

---


&lt;!-- --&gt;







## About me

&lt;img align="right" width="210" height="210" alt="a picture of Val" src="images/val.jpeg"&gt;

 * __RSE__ at __Concordia University__ (lab of Dr. Eric Pedersen)
 
 * __Data Scientist__ at __Environment Canada (ECCC)__ (Landscape Science Unit)
 
 * Have been coding in R for ~ 7-8 years
 
 * Maintaining 4 packages (2 on CRAN), contributed to 3 other
 
 * B.Sc. (Hons) &amp; M.Sc. McGill University (Biology)
 
 * Website: [___vlucet.github.io___](https://vlucet.github.io/)

---
name: plan 1
## Workshop: Part 1 (now -&gt; 10:30)

&lt;!-- 9:30 - 9:35 : let people trickle in --&gt;
&lt;!-- 9:35 - 9:40 : personal introduction --&gt;

1. __Research software in Eco-Evo__ (__~ 10 minutes__) &lt;!-- 9:40 - 9:50 --&gt;
  * What is research software?
  * To Package or not to Package: what are the alternatives?
    
2. __Design patterns: the "tooling" vs "workflow" paradigms__ (__~ 10 minutes__) &lt;!-- 9:50 - 10:00 --&gt;
  * General vs workflow oriented packaging.
  * Object-oriented designs and functional programming.
  
3. __From "spaghetti code" to "packaged" code__ (__~ 20 minutes__) &lt;!-- 10:00 - 10:20 --&gt;
  * Tips and tricks to modularize your research code.
  * How to write clean code.
  * (__Break: 10 minutes__) &lt;!-- 10:20 - 10:30 --&gt;

---
name: plan 2
## Workshop: Parts 2 &amp; 3 (10:30 -&gt; 12:30)

4. __Your personal assistants: `usethis` and `devtools`__ (__~ 50 minutes__) &lt;!-- 10:30 - 11:20 --&gt;
  * Let's create an example package step by step.
  * (__Break: 10 minutes__) &lt;!-- 11:20 - 11:30 --&gt;
  
5. __Package testing, maintenance and distribution: best practices__ (__~ 50 minutes__) &lt;!-- 11:30 - 12:20 --&gt;
  * How to test, maintain, and distribute your package.

__Q &amp; A__: If time allows, __~ 10 minutes__ (or on the conference app at any time) 

---
name: prereqs

## Before we get started...

For today, it is recommended that you are already pretty well acquainted with __R__ and __Rstudio__. But, if at least you...
  * Have written a few __functions with multiple arguments__ in R 
  * Know about "__project oriented workflow__" (for instance you use RStudio projects) 
  
...then you have the bare minimum we need for today!

Knowledge of Git/Github is also welcome as I won't have the time to explain version control software.


```r
# Run this in R before we start. 
pkgs &lt;- c("devtools", "roxygen2", "usethis")
install.packages(pkgs)
```

_Note: the first part of the workshop is relevant to users of any level._

---
name: refs

## On not reinventing the wheel...

There exists a __plethora of great resources on R package making__, resources from which I have learned myself. 

This workshop has been devised by attempting to __synthesize many freely available resources__ put together by a whole bunch of excellent people. 

_A full list of resources is included at the end of this workshop._

.center[
![Comic, 2 characters. The first character shows a picture of a wheel to a befuddled second character and says "I have a great idea!"](https://miro.medium.com/max/240/0*FiszegEhSoYnfqO9.png)]

---
class: inverse center middle

## Research software in Eco-Evo 

---
## What is research software?

__Research software__ can be defined as any computer-based application that directly or indirectly supports users in a research task&lt;sup&gt;1&lt;/sup&gt;.

For example: 
- Any software packages used to conduct research, but also
- Any script that employ these packages, and
- Any code or program used to manage and process data

Can also include:
- Proprietary software (Matlab, ArcGIS, etc...)
- Any program that runs on data collection hardware
 - Camera traps
 - Temperature sensors
 - etc.

.footnote[[1] [IGI Global](https://www.igi-global.com/dictionary/knowledge-visualization-for-research-design/69111)]

---
## Who writes research software?

__Research software__ is written by __Research software engineers__

_A Research Software Engineer (RSE) combines professional software engineering expertise with an intimate understanding of research._&lt;sup&gt;1&lt;/sup&gt;

A wider definition would also include, independently of whether they have received formal training in software engineering:
- Any __HQP__ (Highly Trained Personnel) who writes code in a research context (grad student, post-doc, etc.)
- Research assistant, lab managers, undergraduate students involved in producing code

The RSE hat is often shared and worn by different people in a lab, and increasingly researchers are required to acquire RSE skills.

.footnote[[1] [RSE Society](https://society-rse.org/about/)]

---
## RSE &amp; code "openness"

&lt;a href="https://journals.plos.org/plosbiology/article?id=10.1371/journal.pbio.3000763"&gt; &lt;img src="images/low_avail.png" align="left" width="400" alt='Low availability of code in ecology: A call for urgent action (screenshot of a research paper)'/&gt; &lt;/a&gt;

&lt;a href="https://www.cell.com/trends/ecology-evolution/fulltext/S0169-5347(15)00290-6?_returnURL=https%3A%2F%2Flinkinghub.elsevier.com%2Fretrieve%2Fpii%2FS0169534715002906%3Fshowall%3Dtrue"&gt; &lt;img src="images/elevating.png" width="250" alt='Elevating the status of code in ecology (screenshot of a research paper)'/&gt; &lt;/a&gt;

&lt;a href="https://www.nature.com/articles/467753a"&gt; &lt;img src="images/publish_your_code.png" align="center" width="500" alt='Publish your computer code, it is good enough'/&gt;  &lt;/a&gt;

__Software &amp; Code literacy__, i.e. the ability to write, test and deliver reproducible code, is an essential skill to solve the reproducibility crisis in Eco-Evo.

---
## Open source software

&lt;img src="https://imgs.xkcd.com/comics/dependency_2x.png" align="right" width="350" alt='XKCD comic, where "all modern digital infrastructure" is represented as a jenga tower whose stability completely relies on "a project some rabdom person has been thanklessly maintaining since 2003"'/&gt;

_Open source software is software with source code that anyone can inspect, modify, and enhance._&lt;sup&gt;1&lt;/sup&gt;

Like most research, research in eco-evo could not take place without OSS (think of the R language and the all the add-on packages).

Good RSE is therefore guided by OSS principles, paradigms, and tools, the width of it being too large to cover today.

.footnote[[1] [opensource.com](https://opensource.com/resources/what-open-source)]

---
## FAIR Software&lt;sup&gt;1&lt;/sup&gt;

1. __Findable__
  - rich metadata + unique, persistent, identifier.

2. __Accessible__
  - metadata is both  machine AND human readable.
  - deposited in trusted community approved repository.

3. __Interoperable__
  - uses community accepted standards and platforms.

4. __Reusable__
  - clear licence and documentation.
  
.footnote[[1] [library carpentry](https://librarycarpentry.org/Top-10-FAIR/2018/12/01/research-software/)]

---
## Is software a scientific contribution?

Research software is often __not recognized__ as a scientific contribution in its own right. Yet, research code:
- Represents a very significant part of a researcher's time.
- Advances our knowledge of the "how", just like research protocols.
- Should be easily citable to improve methods tractability.

Recognizing RS as a scientific contribution is not a vanity for RS developers: __code should under better scrutiny, and should be submitted to peer review__.

Who is reviewing code?
- [ROpenSci software peer review](https://ropensci.org/).
- [JOSS](https://joss.theoj.org/) and other software journals.

---
class: inverse center middle

# To Package or not to Package?

---
## Should your package exists?

A few questions to ask yourself&lt;sup&gt;1&lt;/sup&gt; :

1. Will this piece of software really be useful to someone else than you? 

2. Is your idea really new, or is there already a package out there performing the exact same task?

3. If there is one, would your implementation bring something to the market, e.g. an user-friendlier implementation? 

4. If there is already a similar package, should you work on your own or collaborate with the author(s) of the original package?

5. As a grad student or PI, is the time spent in development worth the effort?

.footnote[[1] [M. Simon's blog post](https://masalmon.eu/2017/12/11/goodrpackages/)]

---
## Private packages

_"Packaging doesn't have to be about sharing the code, it can just be to save yourself time."_&lt;sup&gt;1&lt;/sup&gt;

Packages do not have to be written for someone else than yourself. Consider writing a personal package. For example, consider packaging Scripts that:
- You have re-used more than once
- You have shared with students and/or collaborators
- Produces this a specific analysis or figure that is often re-used within your lab

Consider starting a __lab package project__ where students are encourage to contribute functions and document them, therefore ensuring that the coding knowledge accumulated through often tedious trial and error is curated and can serve you and your students in the future.

.footnote[[1] [H. Parker's blog post](https://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/)]

---
## What other forms does research software take?

A __Package__ is only one way to distribute research code. I want to mention __research compendiums__ as the best alternative to writing and releasing a package.

_The goal of a research compendium is to provide a standard and easily recognizable way for organizing the digital materials of a project to enable others to inspect, reproduce, and extend the research._&lt;sup&gt;1&lt;/sup&gt;

&lt;a href="https://github.com/benmarwick/rrtools"&gt; &lt;img src="images/rrtools.png" align="center" alt='rrtools: Tools for Writing Reproducible Research in R'/&gt;  &lt;/a&gt;

Note: sometimes compendiums are actually R packages bundled in a specific way.

.footnote[[1] [R for Reproducible Research course](https://annakrystalli.me/rrresearch/10_compendium.html)]

&lt;!--
## To Package or not to Package? (cont'd)
&lt;!-- Discuss the effort at different stages of research. 
--&gt;

---
## What should a package contain?

Two principles&lt;sup&gt;1&lt;/sup&gt; :

1. Make your package compatible with the workflow of your users. 

2. Do not get too ambitious. 

I would add, consider principles of the [Unix philosophy](https://en.wikipedia.org/wiki/Unix_philosophy):

1. Small building blocks (small functions for example)

2. "Do One Thing and Do It Well"

.footnote[[1] [M. Simon's blog post](https://masalmon.eu/2017/12/11/goodrpackages/)]

---
## How to name your package

__Naming things is hard__. but here are a few advice&lt;sup&gt;1&lt;/sup&gt; :

1. Use __lower cases__, this way your user doesn’t need to remember where the capital letters are and  full capital letter name looks like screaming.

2. Use the R package `available`, to check whether the name is valid (no special characters, etc.), whether CRAN already hosts a package with the same name and searches the web for unintended meanings of the name.

3. If your package revolves around a __central function__ or interfaces with __another program__, consider using these as the name.

.footnote[[1] [M. Simon's blog post](https://masalmon.eu/2017/12/11/goodrpackages/)]

---
class: inverse center middle

## Design patterns: "tooling" vs "workflow"

---
## Research packages fall into 3 broad categories

From the widest to the narrowest user base, on a continuum from generality to specificity:

1. To provide a __general research tool__ in R.

2. To implement a __method__.

2. To make a certain __workflow__ reproducible and adaptable.

The first 2 are exampless of __tooling__ packages: general purpose, no object structure (or very light). One function does one thing.

The last is an example of a __workflow__ package: can have a strong object structure (but beware!). In the back, may be built with simpler "tooling" elements.

&lt;!--
## "tooling" packages
&lt;!-- Characteristics: general, no object structure (or very light). One function does one thing. Lab package, personal package 
--&gt;
 
&lt;!--
## "workflow" packages 
&lt;!-- Makes a specific research workflow available, can have a strong object structure (but beware!). In the back, may be built with simpler "tooling" elements 
--&gt;

&lt;!--
## A research package decision chart
&lt;!-- Make a decision chart that sums up all we talked about and if we have time ask if there are any questions 
--&gt;

---
class: inverse center middle

## From "spaghetti code" to "packaged" code 

---
## Messy code
&lt;!-- Messy code is not necessarily bad code, but one could argue that it is "unfinished code", no one took the time to clean it up. Why? talk about how this part of the research process might not be valorized as much. --&gt;

Messy code is ubiquitous in research, BUT:

.center[
__Messy code ≠ Bad code__
]

In fact, this is closer to the truth: 

.center[
__Messy code = Unfinished code__
]

Cleaning up research code should be considered an integral part of the research process. It is often the first step in any packaging endeavor.

Two aspects of code "cleanliness":

1. The way __it looks__ (spaces, number of lines, etc.)

2. The way __it reads__ (measured in "WTFs per minute"&lt;sup&gt;1&lt;/sup&gt; as you read it)

.footnote[[1] [Uncle Bob's Clean Code Lectures](https://www.youtube.com/watch?v=7EmboKQH8lM)]

---
## How to write clean (R) code

&lt;a href="https://imgs.xkcd.com/comics/good_code.png"&gt; &lt;img src="https://imgs.xkcd.com/comics/good_code.png" align="right" width=300 alt="XKCD flow chart on how to write good code"/&gt;  &lt;/a&gt;

- Use an __IDE__ (RStudio, VSCode, etc.).

- Learn to follow a style guide, for example [the tidyverse](https://style.tidyverse.org/) or [Google's](https://google.github.io/styleguide/Rguide.html).

- Name things well (re: naming is hard). Don't be afraid to use long, informative function and variable names.

- Write __functional__ code, i.e. code made with functions, each function accomplishing one thing (recall the Unix's Do One Thing Well).

---
## How to write clean (R) code

- Write useful comments: do not comment everything in the code, just the parts that actually need explaining.

- Use tools to identify and fix style issues in code. The packages [`lintr`](https://github.com/jimhester/lintr) and [`goodpractice`](https://github.com/MangoTheCat/goodpractice) are a good way to start.

- Engage in code review: the best way to know if your code is clean to have someone else take a look at it. Consider setting up code review sessions between students and/or collaborators. GitHub makes it easy to get started with reviewing code.

---
## Packaging messy research code
&lt;!-- [mention that these principles are even better to implement as one *writes* the code] identify steps (for workflow) or manipulations and "re-factor" the code into functions, =&gt; then work on modularizing the code, i.e. placing functions in different scripts that can be sourced. etc... --&gt;

---
## Packaging messy research code
&lt;!-- continue the discussion =&gt; think about object oriented design, write a class diagram maybe, and think about attributes that need to be kept track of --&gt;

---
## OOP in R
&lt;!-- use hadley's book in this section to write an intro to the different OOP systems in R --&gt;

---
class: inverse center middle

## A package step by step with {usethis} and {devtools}

---
class: inverse center middle

## Package testing, maintenance and distribution: best practices
&lt;!-- Include licensing in there --&gt;

---
class: center, middle

# Thanks!

Slides created via the R packages:

[**xaringan**](https://github.com/yihui/xaringan)&lt;br&gt;
[gadenbuie/xaringanthemer](https://github.com/gadenbuie/xaringanthemer)

---
name: sources

# Sources

* Maelle Simon's [How to develop good R packages (for open science)](https://masalmon.eu/2017/12/11/goodrpackages/)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "%current%",
"highlightStyle": "github",
"highlightLines": true,
"ratio": "4:3",
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
